<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>GC MASTER ELITE 2025</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap');
        body { font-family: 'Inter', sans-serif; -webkit-tap-highlight-color: transparent; overflow-x: hidden; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .active-scale:active { transform: scale(0.96); }
        .dot-nav { transition: all 0.2s; }
        @keyframes pulse-soft { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
        .loading-ia { animation: pulse-soft 2s infinite; }
    </style>
</head>
<body class="bg-slate-50">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;

        const apiKey = "AIzaSyBl1TDv5-OIBZGYLTCQ_v4g_oxkJPNs6eg"; 
        const modelId = "gemini-2.5-flash-preview-09-2025";

        const TEMAS_DB = [
            { id: 1, name: "Derechos Humanos", block: "Ciencias Jur√≠dicas" },
            { id: 2, name: "Igualdad y Violencia de G√©nero", block: "Ciencias Jur√≠dicas" },
            { id: 3, name: "Prevenci√≥n de Riesgos Laborales", block: "Ciencias Jur√≠dicas" },
            { id: 4, name: "Derecho Constitucional", block: "Ciencias Jur√≠dicas" },
            { id: 5, name: "Derecho de la Uni√≥n Europea", block: "Ciencias Jur√≠dicas" },
            { id: 6, name: "Instituciones Internacionales", block: "Ciencias Jur√≠dicas" },
            { id: 7, name: "Derecho Civil", block: "Ciencias Jur√≠dicas" },
            { id: 8, name: "Derecho Penal", block: "Ciencias Jur√≠dicas" },
            { id: 9, name: "Derecho Procesal Penal", block: "Ciencias Jur√≠dicas" },
            { id: 10, name: "Derecho Administrativo", block: "Ciencias Jur√≠dicas" },
            { id: 11, name: "Protecci√≥n de Datos", block: "Ciencias Jur√≠dicas" },
            { id: 12, name: "Extranjer√≠a e Inmigraci√≥n", block: "Ciencias Jur√≠dicas" },
            { id: 13, name: "Seguridad P√∫blica y Privada", block: "Ciencias Jur√≠dicas" },
            { id: 14, name: "Ministerio del Interior y de Defensa", block: "Ciencias Jur√≠dicas" },
            { id: 15, name: "Fuerzas y Cuerpos de Seguridad", block: "Ciencias Jur√≠dicas" },
            { id: 16, name: "Socio-Cultural: Protecci√≥n Civil", block: "Socio-Culturales" },
            { id: 17, name: "Socio-Cultural: Desarrollo Sostenible", block: "Socio-Culturales" },
            { id: 18, name: "Socio-Cultural: Eficiencia Energ√©tica", block: "Socio-Culturales" },
            { id: 19, name: "T√©cnico: Tecnolog√≠as de la Informaci√≥n", block: "T√©cnico-Cient√≠ficas" },
            { id: 20, name: "T√©cnico: Topograf√≠a", block: "T√©cnico-Cient√≠ficas" },
            { id: 21, name: "T√©cnico: Automovilismo", block: "T√©cnico-Cient√≠ficas" },
            { id: 22, name: "T√©cnico: Armas y Explosivos", block: "T√©cnico-Cient√≠ficas" },
            { id: 23, name: "T√©cnico: Transmisiones", block: "T√©cnico-Cient√≠ficas" },
            { id: 24, name: "Lengua Extranjera: Ingl√©s", block: "Ingl√©s" },
            { id: 25, name: "Ortograf√≠a y Gram√°tica", block: "Lengua Espa√±ola" }
        ];

        const BLOQUES = [...new Set(TEMAS_DB.map(t => t.block))];

        const App = () => {
            const [view, setView] = useState('home');
            const [activeTab, setActiveTab] = useState('bloques');
            const [loading, setLoading] = useState(false);
            const [test, setTest] = useState({ questions: [], current: 0, answers: {} });
            const [errors, setErrors] = useState([]);
            const [numQ, setNumQ] = useState(20);
            const [selectedTarget, setSelectedTarget] = useState(null);

            useEffect(() => {
                const saved = localStorage.getItem('gc_errors_v4');
                if (saved) setErrors(JSON.parse(saved));
            }, []);

            useEffect(() => {
                localStorage.setItem('gc_errors_v4', JSON.stringify(errors));
            }, [errors]);

            const generateIAQuestions = async (targetName, count) => {
                const prompt = `Act√∫a como tribunal de examen de la Guardia Civil. Genera ${count} preguntas de nivel dif√≠cil sobre "${targetName}". 
                Formato JSON: { "questions": [ { "q": "...", "options": ["A", "B", "C", "D"], "correct": 0, "expl": "..." } ] }`;
                
                try {
                    const res = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/${modelId}:generateContent?key=${apiKey}`, {
                        method: "POST",
                        headers: { "Content-Type": "application/json" },
                        body: JSON.stringify({
                            contents: [{ parts: [{ text: prompt }] }],
                            generationConfig: { responseMimeType: "application/json" }
                        })
                    });
                    const data = await res.json();
                    return JSON.parse(data.candidates[0].content.parts[0].text).questions;
                } catch (e) {
                    // Fallback inmediato si la IA falla o tarda
                    return Array.from({length: count}, (_, i) => ({
                        q: `[Error de conexi√≥n IA] Pregunta de respaldo sobre ${targetName} n¬∫ ${i+1}. ¬øCu√°l es el procedimiento correcto seg√∫n la Ley 29/2014?`,
                        options: ["Opci√≥n A (Correcta)", "Opci√≥n B", "Opci√≥n C", "Opci√≥n D"],
                        correct: 0,
                        expl: "Justificaci√≥n de respaldo ante falta de conexi√≥n con el servidor Gemini."
                    }));
                }
            };

            const startTest = async (target) => {
                setLoading(true);
                setSelectedTarget(target);
                const qs = await generateIAQuestions(target.name || target, numQ);
                setTest({ questions: qs, current: 0, answers: {} });
                setLoading(false);
                setView('quiz');
            };

            const handleAnswer = (idx) => {
                if (test.answers[test.current] !== undefined) return;
                const newAnswers = { ...test.answers, [test.current]: idx };
                setTest({ ...test, answers: newAnswers });
                
                if (idx !== test.questions[test.current].correct) {
                    const q = test.questions[test.current];
                    if (!errors.find(e => e.q === q.q)) setErrors([q, ...errors]);
                }
            };

            const removeError = (qText) => {
                setErrors(errors.filter(e => e.q !== qText));
            };

            if (loading) return (
                <div className="min-h-screen bg-[#043d26] flex flex-col items-center justify-center text-white p-6 text-center">
                    <div className="w-20 h-20 border-4 border-white/10 border-t-emerald-400 rounded-full animate-spin mb-8"></div>
                    <h2 className="text-2xl font-black italic mb-2">GEMINI IA DISE√ëANDO TEST...</h2>
                    <p className="text-emerald-300/60 text-xs font-bold uppercase tracking-[0.3em]">Preparando preguntas de nivel oficial</p>
                </div>
            );

            return (
                <div className="min-h-screen max-w-md mx-auto bg-white flex flex-col relative shadow-2xl overflow-hidden">
                    {/* HEADER */}
                    <header className="bg-[#043d26] text-white pt-10 pb-12 px-6 rounded-b-[3rem] shrink-0 z-20 shadow-xl">
                        <div className="flex justify-between items-center mb-8">
                            <div>
                                <h1 className="text-2xl font-black italic tracking-tighter" onClick={() => setView('home')}>GC MASTER ELITE</h1>
                                <p className="text-[10px] text-emerald-400 font-bold uppercase tracking-widest">2025 AI-POWERED</p>
                            </div>
                            <button onClick={() => setView('errors')} className="bg-red-500 text-white px-4 py-2 rounded-2xl text-[10px] font-black uppercase shadow-lg active-scale">
                                Fallos: {errors.length}
                            </button>
                        </div>

                        {view === 'home' && (
                            <div className="flex bg-black/30 p-1.5 rounded-2xl backdrop-blur-md overflow-x-auto no-scrollbar">
                                {[
                                    {id: 'bloques', n: 'Bloques'}, 
                                    {id: 'temas', n: 'Temas'}, 
                                    {id: 'hot', n: 'Top Repetidas'},
                                    {id: '2025', n: 'Examen 2025'}
                                ].map(t => (
                                    <button 
                                        key={t.id} 
                                        onClick={() => setActiveTab(t.id)} 
                                        className={`flex-none px-5 py-2.5 text-[10px] font-black uppercase rounded-xl transition-all ${activeTab === t.id ? 'bg-white text-[#043d26]' : 'text-white/40'}`}
                                    >
                                        {t.n}
                                    </button>
                                ))}
                            </div>
                        )}
                    </header>

                    {/* CONTENT */}
                    <main className="flex-grow overflow-y-auto px-5 -mt-8 no-scrollbar pb-32 z-10">
                        {view === 'home' && (
                            <div className="space-y-4 animate-in fade-in slide-in-from-bottom-4 duration-500">
                                {activeTab === 'bloques' && BLOQUES.map(b => (
                                    <div key={b} onClick={() => { setSelectedTarget({name: b}); setView('config'); }} className="bg-white p-5 rounded-[2rem] shadow-sm border border-slate-100 flex items-center justify-between active-scale">
                                        <span className="text-xs font-black text-slate-800 uppercase tracking-tight">{b}</span>
                                        <span className="text-emerald-500 font-bold">BLOQUE ‚Üí</span>
                                    </div>
                                ))}

                                {activeTab === 'temas' && TEMAS_DB.map(t => (
                                    <div key={t.id} onClick={() => { setSelectedTarget(t); setView('config'); }} className="bg-white p-4 rounded-2xl shadow-sm border border-slate-50 flex items-center gap-4 active-scale">
                                        <span className="w-8 h-8 bg-slate-50 rounded-lg flex items-center justify-center text-[10px] font-black text-slate-300">{t.id}</span>
                                        <div className="flex-1">
                                            <p className="text-[13px] font-bold text-slate-700 leading-tight">{t.name}</p>
                                            <p className="text-[8px] font-black text-slate-300 uppercase mt-0.5">{t.block}</p>
                                        </div>
                                    </div>
                                ))}

                                {activeTab === 'hot' && (
                                    <div className="space-y-3">
                                        <div className="bg-orange-500 p-4 rounded-[2rem] text-white">
                                            <p className="text-[10px] font-black uppercase opacity-80">Selecci√≥n IA</p>
                                            <p className="text-sm font-bold italic underline">Preguntas calientes de ex√°menes reales</p>
                                        </div>
                                        {TEMAS_DB.slice(0, 5).map(t => (
                                            <div key={t.id} onClick={() => { setSelectedTarget(t); setView('config'); }} className="bg-white p-4 rounded-2xl border-l-4 border-orange-500 shadow-sm active-scale flex justify-between items-center">
                                                <span className="text-xs font-bold text-slate-700">{t.name}</span>
                                                <span className="text-[9px] font-black bg-orange-100 text-orange-600 px-2 py-1 rounded">üî• TOP</span>
                                            </div>
                                        ))}
                                    </div>
                                )}

                                {activeTab === '2025' && (
                                    <div onClick={() => { setSelectedTarget({name: "Examen Oficial 2025"}); setView('config'); }} className="bg-slate-900 p-8 rounded-[3rem] shadow-2xl active-scale text-center relative overflow-hidden group">
                                        <div className="absolute top-0 right-0 p-4 opacity-10 text-6xl group-hover:scale-125 transition-transform">‚öñÔ∏è</div>
                                        <p className="text-emerald-400 text-[10px] font-black uppercase tracking-[0.3em] mb-2">Simulacro Real</p>
                                        <h3 className="text-white text-2xl font-black italic uppercase">CONVOCATORIA 2025</h3>
                                        <p className="text-white/40 text-[9px] mt-4 font-bold uppercase italic">Actualizado con IA seg√∫n BOE actual</p>
                                    </div>
                                )}
                            </div>
                        )}

                        {view === 'config' && (
                            <div className="bg-white p-8 rounded-[3rem] shadow-2xl border mt-4 text-center animate-in zoom-in-95 duration-300">
                                <h3 className="text-xl font-black text-[#043d26] mb-2 uppercase italic">{selectedTarget.name}</h3>
                                <p className="text-slate-400 text-[10px] font-black mb-10 tracking-widest uppercase">N√∫mero de preguntas</p>
                                <div className="grid grid-cols-5 gap-2 mb-10">
                                    {[20, 25, 50, 75, 100].map(n => (
                                        <button key={n} onClick={() => setNumQ(n)} className={`py-4 rounded-2xl font-black text-[10px] ${numQ === n ? 'bg-[#043d26] text-white shadow-xl' : 'bg-slate-100 text-slate-400'}`}>{n}</button>
                                    ))}
                                </div>
                                <button onClick={() => startTest(selectedTarget)} className="w-full bg-emerald-600 text-white py-6 rounded-[2.5rem] font-black shadow-xl active-scale">GENERAR TEST IA</button>
                                <button onClick={() => setView('home')} className="mt-8 text-[10px] font-black text-slate-300 uppercase underline">Cancelar</button>
                            </div>
                        )}

                        {view === 'quiz' && (
                            <div className="space-y-4 pt-4 animate-in slide-in-from-right-10 duration-300">
                                <div className="flex gap-1.5 overflow-x-auto no-scrollbar py-2">
                                    {test.questions.map((_, i) => (
                                        <div 
                                            key={i} 
                                            onClick={() => setTest({...test, current: i})}
                                            className={`dot-nav h-2 min-w-[14px] rounded-full cursor-pointer ${test.current === i ? 'bg-emerald-500 w-6' : (test.answers[i] !== undefined ? 'bg-emerald-200' : 'bg-slate-200')}`}
                                        ></div>
                                    ))}
                                </div>

                                <div className="bg-white p-7 rounded-[2.5rem] shadow-xl border border-slate-100 min-h-[440px] relative">
                                    <div className="flex justify-between items-center mb-8">
                                        <span className="text-[10px] font-black text-emerald-600 bg-emerald-50 px-3 py-1 rounded-full">{test.current + 1} / {test.questions.length}</span>
                                        <button onClick={() => setView('results')} className="text-[10px] font-black text-red-500 uppercase underline">Finalizar Test</button>
                                    </div>

                                    <h2 className="text-[16px] font-bold text-slate-800 mb-8 leading-snug">{test.questions[test.current].q}</h2>
                                    
                                    <div className="space-y-3">
                                        {test.questions[test.current].options.map((opt, i) => {
                                            const answered = test.answers[test.current] !== undefined;
                                            const correct = test.questions[test.current].correct;
                                            const selected = test.answers[test.current];

                                            let style = "bg-slate-50 border-slate-100 text-slate-600";
                                            if (answered) {
                                                if (i === correct) style = "bg-emerald-50 border-emerald-500 text-emerald-800 font-bold ring-2 ring-emerald-50";
                                                else if (i === selected) style = "bg-red-50 border-red-500 text-red-800 font-bold ring-2 ring-red-50";
                                                else style = "opacity-40 bg-slate-50 grayscale";
                                            }

                                            return (
                                                <button key={i} onClick={() => !answered && handleAnswer(i)} className={`w-full p-4 rounded-2xl border-2 text-left text-sm font-bold flex gap-4 transition-all active-scale ${style}`}>
                                                    <span className="w-6 h-6 shrink-0 bg-white border rounded-lg flex items-center justify-center text-[10px] font-black">{String.fromCharCode(65+i)}</span>
                                                    {opt}
                                                </button>
                                            );
                                        })}
                                    </div>

                                    {test.answers[test.current] !== undefined && (
                                        <div className="mt-8 p-5 bg-blue-50 rounded-[2rem] border border-blue-100 animate-in fade-in">
                                            <p className="text-[9px] font-black text-blue-600 uppercase mb-2">Justificaci√≥n IA:</p>
                                            <p className="text-[11px] font-medium text-blue-800 leading-relaxed italic">{test.questions[test.current].expl}</p>
                                        </div>
                                    )}
                                </div>

                                <div className="flex gap-3 mb-12">
                                    <button onClick={() => setTest({...test, current: Math.max(0, test.current - 1)})} className="flex-1 bg-white text-slate-400 py-5 rounded-2xl font-black text-[10px] border border-slate-100 active-scale uppercase">Anterior</button>
                                    <button 
                                        onClick={() => {
                                            if(test.current < test.questions.length - 1) setTest({...test, current: test.current + 1});
                                            else setView('results');
                                        }}
                                        className="flex-[2] bg-[#043d26] text-white py-5 rounded-2xl font-black text-[10px] shadow-xl active-scale uppercase tracking-widest"
                                    >
                                        {test.current === test.questions.length - 1 ? 'RESULTADOS' : 'Siguiente'}
                                    </button>
                                </div>
                            </div>
                        )}

                        {view === 'errors' && (
                            <div className="pt-4 space-y-4 animate-in slide-in-from-bottom-8">
                                <div className="flex justify-between items-center mb-6">
                                    <h2 className="text-2xl font-black text-red-600 italic uppercase">C√°mara de Fallos</h2>
                                    <button onClick={() => setView('home')} className="text-[10px] font-black text-slate-400 underline">Cerrar</button>
                                </div>
                                {errors.length === 0 ? (
                                    <div className="text-center py-24 grayscale opacity-20"><p className="text-6xl mb-4">üõ°Ô∏è</p><p className="font-black italic text-xs uppercase">Sin errores pendientes</p></div>
                                ) : (
                                    errors.map((err, i) => (
                                        <div key={i} className="bg-white p-6 rounded-[2.5rem] shadow-sm border border-red-50 border-l-4 border-l-red-500 relative">
                                            <button onClick={() => removeError(err.q)} className="absolute top-4 right-4 text-[9px] font-black text-slate-300 hover:text-red-500 uppercase underline">Aprendida</button>
                                            <p className="text-[9px] font-black text-red-500 uppercase mb-2">{err.topic || "Error Guardado"}</p>
                                            <p className="text-sm font-bold text-slate-800 mb-4 pr-10">{err.q}</p>
                                            <div className="bg-emerald-50 p-3 rounded-xl border border-emerald-100">
                                                <p className="text-[10px] font-black text-emerald-600 uppercase">Correcta:</p>
                                                <p className="text-xs font-bold text-emerald-800">{err.options[err.correct]}</p>
                                            </div>
                                        </div>
                                    ))
                                )}
                            </div>
                        )}

                        {view === 'results' && (
                            <div className="text-center py-16 animate-in zoom-in-90 duration-500">
                                <p className="text-[10px] font-black text-emerald-600 uppercase mb-4 tracking-[0.5em]">Calificaci√≥n Simulacro</p>
                                <div className="text-9xl font-black text-[#043d26] mb-10 tracking-tighter">
                                    {Math.round((Object.keys(test.answers).filter(k => test.answers[k] === test.questions[k].correct).length / test.questions.length) * 100)}<span className="text-3xl text-slate-300">%</span>
                                </div>
                                <div className="px-6 space-y-3">
                                    <button onClick={() => setView('home')} className="w-full bg-[#043d26] text-white py-6 rounded-[2.5rem] font-black shadow-2xl active-scale uppercase">Volver al Panel</button>
                                    <button onClick={() => startTest(selectedTarget)} className="w-full bg-slate-100 text-slate-400 py-4 rounded-2xl font-black text-[10px] uppercase italic">Repetir con IA</button>
                                </div>
                            </div>
                        )}
                    </main>

                    {/* BOTTOM BAR */}
                    {view === 'home' && (
                        <nav className="fixed bottom-6 left-5 right-5 max-w-md mx-auto bg-white/80 backdrop-blur-2xl border border-white/50 h-20 rounded-[2.5rem] shadow-2xl flex items-center justify-around px-8 z-50">
                            <button className="flex flex-col items-center gap-1 text-[#043d26]"><span className="text-2xl">üèõÔ∏è</span><span className="text-[8px] font-black uppercase">Panel</span></button>
                            <button onClick={() => setView('errors')} className="flex flex-col items-center gap-1 text-slate-300"><span className="text-2xl">‚ö°</span><span className="text-[8px] font-black uppercase">Fallos</span></button>
                            <button className="flex flex-col items-center gap-1 text-slate-300"><span className="text-2xl">üèÜ</span><span className="text-[8px] font-black uppercase">Top</span></button>
                        </nav>
                    )}
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>


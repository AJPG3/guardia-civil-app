<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>GC MASTER ELITE</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap');
        body { font-family: 'Inter', sans-serif; -webkit-tap-highlight-color: transparent; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .active-scale:active { transform: scale(0.96); }
    </style>
</head>
<body class="bg-slate-50">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // --- CONFIGURACI√ìN DE DATOS ---
        const TEMAS = Array.from({length: 25}, (_, i) => ({ id: i + 1, name: `Tema ${i + 1}`, cat: i < 15 ? "Jur√≠dico" : (i < 18 ? "Socio-Cultural" : "T√©cnico") }));
        const AUX = [
            { id: 'PSI', name: "Psicot√©cnicos" }, { id: 'ING', name: "Ingl√©s" },
            { id: 'ORT', name: "Ortograf√≠a" }, { id: 'GRA', name: "Gram√°tica" }
        ];

        const App = () => {
            const [view, setView] = useState('home');
            const [activeTab, setActiveTab] = useState('temas');
            const [test, setTest] = useState({ questions: [], current: 0, answers: {} });
            const [errors, setErrors] = useState([]); // Almac√©n de errores
            const [numQ, setNumQ] = useState(20);
            const [selectedTopic, setSelectedTopic] = useState(null);

            // Cargar errores guardados al iniciar
            useEffect(() => {
                const saved = localStorage.getItem('gc_errors');
                if (saved) setErrors(JSON.parse(saved));
            }, []);

            // Guardar errores cada vez que cambien
            useEffect(() => {
                localStorage.setItem('gc_errors', JSON.stringify(errors));
            }, [errors]);

            const startTest = (topic) => {
                const qs = Array.from({ length: numQ }, (_, i) => ({
                    id: i,
                    topic: topic.name,
                    q: `Pregunta de examen de ${topic.name} n¬∫ ${i+1}`,
                    options: ["Respuesta A (Correcta)", "Respuesta B", "Respuesta C", "Respuesta D"],
                    correct: 0,
                    expl: "Justificaci√≥n detallada seg√∫n el BOE y temario oficial."
                }));
                setTest({ questions: qs, current: 0, answers: {} });
                setView('quiz');
            };

            const handleAnswer = (qIdx, ansIdx) => {
                const newAnswers = { ...test.answers, [qIdx]: ansIdx };
                setTest({ ...test, answers: newAnswers });
                
                // Si es incorrecta, a√±adir al almac√©n de errores (si no estaba ya)
                if (ansIdx !== test.questions[qIdx].correct) {
                    const errorItem = test.questions[qIdx];
                    if (!errors.find(e => e.q === errorItem.q)) {
                        setErrors([...errors, errorItem]);
                    }
                }
            };

            const removeError = (idx) => {
                const newErrors = errors.filter((_, i) => i !== idx);
                setErrors(newErrors);
            };

            const getProgressColor = (idx) => {
                if (test.answers[idx] === undefined) return 'bg-slate-200';
                return 'bg-emerald-500';
            };

            return (
                <div className="min-h-screen max-w-md mx-auto bg-white shadow-xl overflow-hidden flex flex-col">
                    {/* CABECERA */}
                    <header className="bg-[#064d2e] text-white p-6 pb-10 rounded-b-[2rem] shrink-0 shadow-lg">
                        <div className="flex justify-between items-center mb-4">
                            <h1 className="text-xl font-black italic tracking-tighter cursor-pointer" onClick={() => setView('home')}>GC MASTER</h1>
                            <div className="flex gap-2">
                                <button onClick={() => setView('errors')} className="bg-red-500/20 text-red-200 px-3 py-1 rounded-full text-[10px] font-black border border-red-500/30">
                                    ERRORES: {errors.length}
                                </button>
                            </div>
                        </div>
                        {view === 'home' && (
                            <div className="flex bg-black/20 p-1 rounded-xl">
                                {['temas', 'bloques', 'aux'].map(t => (
                                    <button key={t} onClick={() => setActiveTab(t)} className={`flex-1 py-2 text-[10px] font-black uppercase rounded-lg ${activeTab === t ? 'bg-white text-[#064d2e]' : 'text-white/50'}`}>{t}</button>
                                ))}
                            </div>
                        )}
                    </header>

                    <main className="flex-grow overflow-y-auto px-4 -mt-6 no-scrollbar pb-24">
                        {view === 'home' && (
                            <div className="space-y-4">
                                {activeTab === 'temas' && TEMAS.map(t => (
                                    <div key={t.id} onClick={() => { setSelectedTopic(t); setView('config'); }} className="bg-white p-4 rounded-2xl shadow-sm border flex items-center justify-between active-scale">
                                        <div className="flex items-center gap-3">
                                            <span className="text-xs font-black text-slate-400 w-6">{t.id}</span>
                                            <span className="text-sm font-bold text-slate-700">{t.name}</span>
                                        </div>
                                        <span className="text-xs font-bold text-slate-300">TEST ‚Üí</span>
                                    </div>
                                ))}
                                {activeTab === 'aux' && AUX.map(t => (
                                    <div key={t.id} onClick={() => { setSelectedTopic(t); setView('config'); }} className="bg-white p-6 rounded-[2rem] shadow-sm border flex items-center justify-between active-scale">
                                        <span className="font-black text-slate-800 uppercase italic">{t.name}</span>
                                        <span className="text-emerald-500">‚òÖ</span>
                                    </div>
                                ))}
                            </div>
                        )}

                        {view === 'config' && (
                            <div className="bg-white p-8 rounded-[2rem] shadow-xl border mt-4 text-center">
                                <h3 className="text-xl font-black text-[#064d2e] mb-2 uppercase">{selectedTopic.name}</h3>
                                <p className="text-slate-400 text-xs font-bold mb-6">SELECCIONA N√öMERO DE PREGUNTAS</p>
                                <div className="grid grid-cols-3 gap-2 mb-8">
                                    {[20, 25, 50, 75, 100].map(n => (
                                        <button key={n} onClick={() => setNumQ(n)} className={`py-3 rounded-xl font-black text-xs ${numQ === n ? 'bg-[#064d2e] text-white' : 'bg-slate-100 text-slate-400'}`}>{n}</button>
                                    ))}
                                </div>
                                <button onClick={() => startTest(selectedTopic)} className="w-full bg-emerald-600 text-white py-4 rounded-2xl font-black shadow-lg shadow-emerald-200">EMPEZAR AHORA</button>
                                <button onClick={() => setView('home')} className="mt-4 text-xs font-bold text-slate-300 uppercase">Volver</button>
                            </div>
                        )}

                        {view === 'quiz' && (
                            <div className="space-y-4 pt-4">
                                {/* BARRA DE PROGRESO INTERACTIVA */}
                                <div className="flex gap-1 overflow-x-auto no-scrollbar py-2">
                                    {test.questions.map((_, i) => (
                                        <div 
                                            key={i} 
                                            onClick={() => setTest({...test, current: i})}
                                            className={`h-1.5 min-w-[12px] rounded-full transition-all ${test.current === i ? 'ring-2 ring-emerald-500 ring-offset-2' : ''} ${getProgressColor(i)}`}
                                        ></div>
                                    ))}
                                </div>

                                <div className="bg-white p-6 rounded-[2rem] shadow-xl border min-h-[400px]">
                                    <p className="text-[10px] font-black text-emerald-600 mb-2 uppercase">Pregunta {test.current + 1}</p>
                                    <h2 className="text-lg font-bold text-slate-800 mb-6">{test.questions[test.current].q}</h2>
                                    <div className="space-y-2">
                                        {test.questions[test.current].options.map((opt, i) => {
                                            const isAnswered = test.answers[test.current] !== undefined;
                                            const isCorrect = i === test.questions[test.current].correct;
                                            const isSelected = test.answers[test.current] === i;

                                            let style = "bg-slate-50 border-slate-100";
                                            if (isAnswered) {
                                                if (isCorrect) style = "bg-emerald-100 border-emerald-500 text-emerald-800";
                                                else if (isSelected) style = "bg-red-100 border-red-500 text-red-800";
                                                else style = "opacity-40 grayscale bg-slate-50";
                                            }

                                            return (
                                                <button key={i} onClick={() => handleAnswer(test.current, i)} className={`w-full p-4 rounded-xl border-2 text-left text-sm font-bold flex gap-3 transition-all ${style}`}>
                                                    <span className="w-5 h-5 shrink-0 bg-white border rounded flex items-center justify-center text-[10px]">{String.fromCharCode(65+i)}</span>
                                                    {opt}
                                                </button>
                                            );
                                        })}
                                    </div>
                                    {test.answers[test.current] !== undefined && (
                                        <div className="mt-6 p-4 bg-blue-50 rounded-xl text-[11px] text-blue-800 italic leading-relaxed">
                                            {test.questions[test.current].expl}
                                        </div>
                                    )}
                                </div>

                                <div className="flex gap-3">
                                    <button 
                                        onClick={() => setTest({...test, current: Math.max(0, test.current - 1)})}
                                        className="flex-1 bg-slate-100 text-slate-600 py-4 rounded-2xl font-black text-xs active-scale"
                                    >
                                        ANTERIOR
                                    </button>
                                    <button 
                                        onClick={() => {
                                            if(test.current < test.questions.length - 1) setTest({...test, current: test.current + 1});
                                            else setView('results');
                                        }}
                                        className="flex-[2] bg-[#064d2e] text-white py-4 rounded-2xl font-black text-xs shadow-lg active-scale"
                                    >
                                        {test.current === test.questions.length - 1 ? 'FINALIZAR TEST' : 'SIGUIENTE'}
                                    </button>
                                </div>
                            </div>
                        )}

                        {view === 'errors' && (
                            <div className="space-y-4 pt-4">
                                <div className="flex justify-between items-center">
                                    <h2 className="text-xl font-black text-red-600 italic uppercase">Almac√©n de Fallos</h2>
                                    <button onClick={() => setView('home')} className="text-xs font-bold text-slate-400">CERRAR</button>
                                </div>
                                {errors.length === 0 ? (
                                    <p className="text-center text-slate-400 py-20 font-bold italic uppercase">No tienes fallos guardados. ¬°Buen trabajo!</p>
                                ) : (
                                    errors.map((err, i) => (
                                        <div key={i} className="bg-white p-5 rounded-2xl shadow-sm border border-red-100">
                                            <div className="flex justify-between mb-2">
                                                <span className="text-[9px] font-black text-red-500 uppercase bg-red-50 px-2 py-0.5 rounded">{err.topic}</span>
                                                <button onClick={() => removeError(i)} className="text-[9px] font-black text-slate-300 hover:text-red-500 uppercase tracking-tighter underline">BORRAR DE MEMORIA</button>
                                            </div>
                                            <p className="text-sm font-bold text-slate-800 mb-2">{err.q}</p>
                                            <p className="text-[11px] text-emerald-600 font-bold">Respuesta correcta: {err.options[err.correct]}</p>
                                        </div>
                                    ))
                                )}
                            </div>
                        )}

                        {view === 'results' && (
                            <div className="text-center py-20 animate-in zoom-in-95">
                                <h2 className="text-4xl font-black text-[#064d2e] italic mb-4">RESULTADOS</h2>
                                <div className="text-6xl font-black text-emerald-500 mb-8">
                                    {Object.keys(test.answers).filter(k => test.answers[k] === test.questions[k].correct).length} / {test.questions.length}
                                </div>
                                <button onClick={() => setView('home')} className="w-full bg-[#064d2e] text-white py-5 rounded-[2rem] font-black shadow-xl">VOLVER AL PANEL</button>
                            </div>
                        )}
                    </main>

                    {/* BARRA INFERIOR SOLO EN HOME */}
                    {view === 'home' && (
                        <div className="fixed bottom-0 left-0 right-0 max-w-md mx-auto bg-white border-t p-4 flex justify-around">
                            <button className="text-[#064d2e] flex flex-col items-center gap-1 font-black text-[10px]"><span>üè†</span>INICIO</button>
                            <button onClick={() => setView('errors')} className="text-slate-300 flex flex-col items-center gap-1 font-black text-[10px]"><span>‚ö†Ô∏è</span>ERRORES</button>
                            <button className="text-slate-300 flex flex-col items-center gap-1 font-black text-[10px]"><span>üèÜ</span>RANKING</button>
                        </div>
                    )}
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>

<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>GC MASTER ELITE - FINALIZAR TEST</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800;900&display=swap');
        body { font-family: 'Inter', sans-serif; -webkit-tap-highlight-color: transparent; overflow: hidden; background-color: #f8fafc; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .active-scale:active { transform: scale(0.96); }
        .glass-header { 
            background: linear-gradient(135deg, #043d26 0%, #08633e 100%);
            position: sticky;
            top: 0;
            z-index: 50;
        }
        .main-scroll-area {
            height: calc(100vh - 80px); 
            overflow-y: auto;
            padding-bottom: 140px; /* Margen extra para el nav inferior */
        }
        .hot-gradient {
            background: linear-gradient(90deg, #ff4b2b 0%, #ff416c 100%);
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        const apiKey = ""; 
        const modelId = "gemini-2.5-flash-preview-09-2025";

        // Base de datos de Ex√°menes Oficiales 2022-2025
        const EXAMENES_OFICIALES_DB = {
            "2025": [
                { q: "Pregunta simulada 2025: ¬øQu√© rango ostenta el Director General de la Guardia Civil?", options: ["Secretario de Estado", "Subsecretario", "Ministro", "Director de √Årea"], correct: 1, expl: "Tiene rango de Subsecretario." }
            ],
            "2024": [
                { q: "Seg√∫n la CE, ¬øcu√°l es la base de la organizaci√≥n territorial del Estado?", options: ["Las CCAA", "Municipios, Provincias y CCAA", "Las Regiones", "Solo Provincias"], correct: 1, expl: "Art. 137 CE: Municipios, Provincias y CCAA." }
            ],
            "2023": [
                { q: "¬øPlazo m√°ximo de detenci√≥n preventiva por terrorismo?", options: ["24h", "48h", "72h", "48h adicionales"], correct: 3, expl: "Art. 520 bis LECrim permite pr√≥rroga de hasta 48h adicionales." }
            ],
            "2022": [
                { q: "¬øEn qu√© t√≠tulo de la CE se regulan los Derechos y Deberes fundamentales?", options: ["T√≠tulo Preliminar", "T√≠tulo I", "T√≠tulo II", "T√≠tulo III"], correct: 1, expl: "T√≠tulo I CE." }
            ]
        };

        const TEMAS_OFICIALES = [
            "Derechos Humanos", "Igualdad", "Prevenci√≥n Riesgos", "Constitucional", "Derecho UE",
            "Inst. Internacionales", "Derecho Civil", "Derecho Penal", "Procesal Penal", "Derecho Administrativo",
            "Protecci√≥n Datos", "Extranjer√≠a", "Seguridad P√∫blica", "Interior y Defensa", "FCS",
            "Guardia Civil", "Protecci√≥n Civil", "Tecnolog√≠as", "Topograf√≠a", "Deontolog√≠a",
            "Menores", "Armas y Explosivos", "Terrorismo", "Ingl√©s", "Ortograf√≠a y Gram√°tica"
        ].map((name, i) => ({ id: i + 1, name, block: i < 17 ? "Derecho" : "T√©cnico" }));

        const AUX_TESTS = [
            { id: 'psic', name: "Psicot√©cnicos √ìmnibus", type: "Psicot√©cnicos", icon: "üß†" },
            { id: 'gram', name: "Gram√°tica Espa√±ola", type: "Lengua", icon: "‚úçÔ∏è" },
            { id: 'voca', name: "Vocabulario T√©cnico", type: "Lengua", icon: "üìñ" },
            { id: 'engl', name: "English Grammar", type: "Idiomas", icon: "üá¨üáß" }
        ];

        const App = () => {
            const [view, setView] = useState('home');
            const [activeTab, setActiveTab] = useState('temas');
            const [loading, setLoading] = useState(false);
            const [test, setTest] = useState({ questions: [], current: 0, answers: {}, source: '' });
            const [numQ, setNumQ] = useState(20);
            const [selectedTarget, setSelectedTarget] = useState(null);

            const startOfficialTest = (year) => {
                const questions = EXAMENES_OFICIALES_DB[year] || [];
                setTest({ questions, current: 0, answers: {}, source: `Oficial ${year}` });
                setView('quiz');
            };

            const startIATest = async (target) => {
                setLoading(true);
                const prompt = `Genera ${numQ} preguntas sobre "${target.name || target}" para Guardia Civil. JSON: {"questions": [{"q": "...", "options": ["A", "B", "C", "D"], "correct": 0, "expl": "..."}]}`;
                try {
                    const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/${modelId}:generateContent?key=${apiKey}`, {
                        method: "POST",
                        headers: { "Content-Type": "application/json" },
                        body: JSON.stringify({ contents: [{ parts: [{ text: prompt }] }], generationConfig: { responseMimeType: "application/json" } })
                    });
                    const data = await response.json();
                    const questions = JSON.parse(data.candidates[0].content.parts[0].text.replace(/```json|```/g, "")).questions;
                    setTest({ questions, current: 0, answers: {}, source: 'IA Trainer' });
                    setView('quiz');
                } catch (e) {
                    setTest({ questions: [{q: "Error IA", options: ["A","B","C","D"], correct: 0, expl: "Reintenta."}], current: 0, answers: {}, source: 'Error' });
                    setView('quiz');
                }
                setLoading(false);
            };

            if (loading) return (
                <div className="h-screen bg-[#043d26] flex flex-col items-center justify-center text-white">
                    <div className="w-12 h-12 border-4 border-emerald-400 border-t-transparent rounded-full animate-spin mb-4"></div>
                    <p className="text-[10px] font-black uppercase tracking-widest">Preparando examen oficial...</p>
                </div>
            );

            return (
                <div className="max-w-md mx-auto bg-white h-screen flex flex-col relative shadow-2xl">
                    
                    {/* Header con Z-Index superior */}
                    <header className="glass-header px-6 pt-14 pb-8 rounded-b-[3rem] shadow-xl shrink-0">
                        <div className="flex justify-between items-center mb-8">
                            <div>
                                <h1 className="text-2xl font-black italic text-white tracking-tighter">GC MASTER <span className="text-emerald-400">ELITE</span></h1>
                                <p className="text-[8px] text-emerald-200/50 font-bold uppercase tracking-[0.4em] mt-1">Academia 2025</p>
                            </div>
                        </div>

                        {view === 'home' && (
                            <div className="flex bg-black/20 p-1.5 rounded-2xl overflow-x-auto no-scrollbar backdrop-blur-md border border-white/5">
                                {[
                                    { id: 'temas', label: 'Temario' },
                                    { id: 'hot', label: 'üî• Repetidas' },
                                    { id: 'oficiales', label: 'Oficiales' },
                                    { id: 'auxiliares', label: 'Auxiliares' }
                                ].map(tab => (
                                    <button 
                                        key={tab.id}
                                        onClick={() => setActiveTab(tab.id)}
                                        className={`flex-none px-6 py-3 text-[10px] font-black uppercase rounded-xl transition-all mr-1 ${activeTab === tab.id ? 'bg-white text-[#043d26] shadow-lg' : 'text-white/40'}`}
                                    >
                                        {tab.label}
                                    </button>
                                ))}
                            </div>
                        )}
                    </header>

                    {/* √Årea de scroll con espaciado superior corregido (pt-12) */}
                    <main className="main-scroll-area px-6 pt-12 no-scrollbar">
                        {view === 'home' && (
                            <div className="space-y-4 animate-in fade-in slide-in-from-bottom-4">
                                {activeTab === 'temas' && (
                                    <div className="space-y-3">
                                        {TEMAS_OFICIALES.map(t => (
                                            <div key={t.id} onClick={() => { setSelectedTarget(t); setView('config'); }} className="bg-white p-5 rounded-3xl border border-slate-100 flex items-center gap-4 active-scale shadow-sm">
                                                <div className="w-10 h-10 bg-emerald-50 rounded-2xl flex items-center justify-center text-emerald-700 font-black text-xs">{t.id}</div>
                                                <div className="flex-1">
                                                    <p className="text-sm font-bold text-slate-700 leading-tight">{t.name}</p>
                                                    <p className="text-[8px] font-black text-slate-300 uppercase tracking-tighter">{t.block}</p>
                                                </div>
                                            </div>
                                        ))}
                                    </div>
                                )}

                                {activeTab === 'oficiales' && (
                                    <div className="space-y-4">
                                        {["2025", "2024", "2023", "2022"].map(year => (
                                            <div key={year} onClick={() => startOfficialTest(year)} className="bg-white p-8 rounded-[2.5rem] border border-slate-100 shadow-sm flex justify-between items-center active-scale">
                                                <div>
                                                    <h3 className="text-lg font-black text-slate-800 italic uppercase">EXAMEN {year}</h3>
                                                    <p className="text-[9px] font-bold text-emerald-600 uppercase">Convocatoria Real</p>
                                                </div>
                                                <div className="text-2xl">üìú</div>
                                            </div>
                                        ))}
                                    </div>
                                )}

                                {activeTab === 'hot' && (
                                    <div className="space-y-4">
                                        <div onClick={() => startIATest({name: 'Preguntas Repetidas'})} className="hot-gradient p-12 rounded-[3.5rem] text-center active-scale shadow-2xl relative overflow-hidden group">
                                            <h3 className="text-white text-2xl font-black italic uppercase relative z-10">TEST DE<br/>REPETIDAS</h3>
                                            <p className="text-white/70 text-[9px] font-bold uppercase mt-4 tracking-widest relative z-10">Conceptos Cr√≠ticos</p>
                                        </div>
                                    </div>
                                )}

                                {activeTab === 'auxiliares' && (
                                    <div className="grid gap-4">
                                        {AUX_TESTS.map(aux => (
                                            <div key={aux.id} onClick={() => { setSelectedTarget(aux); setView('config'); }} className="bg-white p-7 rounded-[3rem] border border-slate-100 shadow-sm flex items-center gap-5 active-scale">
                                                <div className="text-4xl">{aux.icon}</div>
                                                <div className="flex-1">
                                                    <h3 className="text-sm font-black text-slate-800 uppercase italic leading-none">{aux.name}</h3>
                                                    <p className="text-[9px] font-bold text-emerald-500 uppercase mt-2">{aux.type}</p>
                                                </div>
                                            </div>
                                        ))}
                                    </div>
                                )}
                            </div>
                        )}

                        {view === 'config' && (
                            <div className="bg-white p-10 rounded-[3.5rem] shadow-2xl animate-in zoom-in-95">
                                <h3 className="text-2xl font-black text-[#043d26] mb-10 text-center uppercase italic">{selectedTarget?.name}</h3>
                                <div className="flex gap-2 mb-10">
                                    {[20, 50, 100].map(n => (
                                        <button key={n} onClick={() => setNumQ(n)} className={`flex-1 py-5 rounded-2xl font-black text-sm transition-all ${numQ === n ? 'bg-[#043d26] text-white' : 'bg-slate-50 text-slate-400'}`}>{n}</button>
                                    ))}
                                </div>
                                <button onClick={() => startIATest(selectedTarget)} className="w-full bg-emerald-600 text-white py-6 rounded-3xl font-black shadow-xl active-scale uppercase tracking-widest italic">Comenzar</button>
                                <button onClick={() => setView('home')} className="w-full mt-6 text-[10px] font-black text-slate-300 uppercase">Cancelar</button>
                            </div>
                        )}

                        {view === 'quiz' && (
                            <div className="animate-in slide-in-from-right-4">
                                <div className="bg-white p-8 rounded-[3.5rem] shadow-xl border border-slate-50 relative min-h-[500px]">
                                    <div className="flex justify-between items-center mb-10">
                                        <div className="bg-emerald-50 px-4 py-2 rounded-2xl">
                                            <span className="text-[10px] font-black text-emerald-600 uppercase">{test.current + 1} / {test.questions.length}</span>
                                        </div>
                                        {/* BOT√ìN ACTUALIZADO: FINALIZAR TEST */}
                                        <button onClick={() => setView('results')} className="text-[10px] font-black text-red-500 uppercase px-4 py-2 bg-red-50 rounded-2xl active-scale shadow-sm">Finalizar Test</button>
                                    </div>

                                    <h2 className="text-lg font-bold text-slate-800 mb-10 leading-snug">{test.questions[test.current]?.q}</h2>

                                    <div className="space-y-3">
                                        {test.questions[test.current]?.options.map((opt, i) => {
                                            const answered = test.answers[test.current] !== undefined;
                                            const isCorrect = i === test.questions[test.current].correct;
                                            const isSelected = i === test.answers[test.current];

                                            let style = "bg-slate-50 border-transparent text-slate-600";
                                            if (answered) {
                                                if (isCorrect) style = "bg-emerald-50 border-emerald-500 text-emerald-800 scale-[1.02]";
                                                else if (isSelected) style = "bg-red-50 border-red-500 text-red-800 opacity-80";
                                                else style = "opacity-30";
                                            }

                                            return (
                                                <button key={i} onClick={() => !answered && setTest({...test, answers: {...test.answers, [test.current]: i}})} className={`w-full p-5 rounded-3xl border-2 text-left text-sm font-semibold flex gap-4 transition-all ${style}`}>
                                                    <span className={`w-7 h-7 shrink-0 rounded-xl flex items-center justify-center text-[11px] font-black ${answered && isCorrect ? 'bg-emerald-500 text-white' : 'bg-white border text-slate-300'}`}>{String.fromCharCode(65+i)}</span>
                                                    <span className="flex-1 mt-0.5">{opt}</span>
                                                </button>
                                            );
                                        })}
                                    </div>

                                    {test.answers[test.current] !== undefined && (
                                        <div className="mt-8 p-6 bg-[#043d26] rounded-3xl text-white animate-in slide-in-from-top-4">
                                            <p className="text-[11px] font-medium leading-relaxed italic">{test.questions[test.current].expl}</p>
                                        </div>
                                    )}
                                </div>

                                <div className="flex gap-4 mt-8">
                                    <button onClick={() => setTest({...test, current: Math.max(0, test.current - 1)})} className="flex-1 bg-white py-6 rounded-3xl font-black text-[10px] uppercase shadow-sm border">Anterior</button>
                                    <button 
                                        onClick={() => {
                                            if(test.current < test.questions.length - 1) setTest({...test, current: test.current + 1});
                                            else setView('results');
                                        }}
                                        className="flex-[2] bg-[#043d26] text-white py-6 rounded-3xl font-black text-[10px] uppercase shadow-xl active-scale"
                                    >
                                        Siguiente
                                    </button>
                                </div>
                            </div>
                        )}

                        {view === 'results' && (
                            <div className="text-center py-20 px-6">
                                <div className="w-40 h-40 bg-emerald-50 rounded-full flex items-center justify-center mx-auto mb-10 border-8 border-emerald-100">
                                    <div className="text-5xl font-black text-[#043d26]">
                                        {Math.round((Object.keys(test.answers).filter(k => test.answers[k] === test.questions[k].correct).length / Math.max(1, test.questions.length)) * 100)}%
                                    </div>
                                </div>
                                <h2 className="text-2xl font-black text-slate-800 mb-12 uppercase italic">Resultados</h2>
                                <button onClick={() => setView('home')} className="w-full bg-[#043d26] text-white py-6 rounded-3xl font-black shadow-2xl active-scale uppercase">Volver al Inicio</button>
                            </div>
                        )}
                    </main>

                    {/* Navbar inferior */}
                    {view === 'home' && (
                        <nav className="fixed bottom-6 left-6 right-6 h-20 bg-[#043d26] rounded-[2.5rem] shadow-2xl flex items-center justify-around px-10 z-[100] border border-white/10">
                            <button className="text-white flex flex-col items-center gap-1.5"><div className="w-1.5 h-1.5 bg-emerald-400 rounded-full"></div><span className="text-[8px] font-black uppercase">Home</span></button>
                            <button className="text-white opacity-40 flex flex-col items-center gap-1.5"><span className="text-lg">üìà</span><span className="text-[8px] font-black uppercase">Stats</span></button>
                            <button className="text-white opacity-40 flex flex-col items-center gap-1.5"><span className="text-lg">‚öôÔ∏è</span><span className="text-[8px] font-black uppercase">Ajustes</span></button>
                        </nav>
                    )}
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
